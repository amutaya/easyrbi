---
title: "`easyrbi`: A Package for retrieving USGS gauges station and landuse data, and calculating stream flashiness"
author: "Wayne Ndlovu and Annah Mutaya"
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{`easyrbi`: A Package for retrieving USGS gauges station and landuse data, and calculating stream flashiness}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
tags:
  - R
  - Rstats
  - tidyverse
  - dataRetrieval
  - easyrbi
authors:
  - name: Wayne Ndlovu
  - name: Annah Mutaya
output:
  rmarkdown::html_vignette:
    df_print: default
    number_sections: no
---
```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(dplyr)
library(tidyr)
library(purrr)
library(dataRetrieval)
library(easyrbi)
library(trend)
library(Kendall)
library(usethis)
```



# Summary
The `easyrbi` package is made with users and hydrologists who are interested in studying stream discharge data in mind. The package contains functions that retrieve streamflow data (pCode = 00060) from the [USGS website](https://waterservices.usgs.gov/rest/Site-Test-Tool.html) and dam removal time series data from [USGS Gages II](https://www.sciencebase.gov/catalog/item/59692a64e4b0d1f9f05fbd39) collected between 1931-01-01 and 2014-12-31. All functions return tidy dataframes which are easy to work with.

# Introduction
To get started, install the `easyrbi` package and load all the necessary packages
```{r, eval=FALSE, message=FALSE}
# If you haven't installed remotes yet, do so:
# install.packages("remotes")
remotes::install_github("amutaya/easyrbi")

library(easyrbi)
library(tidyverse)
library(trend)
library(Kendall)
library(dataRetrieval)
library(usethis)

# create sample sites
study_sites <- c("01564500", "01567000", "01567500", "01568000", "01570000", "01571500", "01573000", "01574000", "01574500", "01576500")
```


# Uses

## Watershed Identification
Ever wondered how large the watershed you are studying is? Or whether the watershed is consired a reference or non-refence site? For any given site numbers, the `basin_id` function generates a dataframe that consists of the watershed identification information as provided by the U.S. Geological Survey (USGS) Geospatial Attributes of Gages for Evaluating Streamflow II (GAGES-II) dataset. The `basin_id` function is interactive, so you can choose to overwrite previously downloaded data files.

### Example 1
```{r, eval=TRUE, warning=FALSE, message=FALSE}
#basin_id(c("01567000", "01490000", "01492500"))
```

### Example 2
```{r, eval=TRUE, warning=FALSE, message=FALSE}
#basin_id(study_sites)
```

## How many dams have been removed close to your study sites?
`easyrbi` allows the user to also download dam removal data recorded between 1931 and 2014 using a simple function that only takes in the site number(s) as an argument. The `dam_removal` function is also interactive, so you can choose to overwrite previously downloaded data files.

### Example 1
```{r, eval=TRUE, warning=FALSE, message=FALSE}
#dam_removal("01066000")
```

annah - rbi_df, site_data, trends
wayne - basin id, dam_removal, dam_trends

### Example 2
```{r, eval=TRUE, warning=FALSE, message=FALSE}
#dam_removal(study_sites)
```

## Investigate the trends at sites where dams were removed.
The `easyrbi` package also help you get a better understanding of the impacts of dam removals on stream flashiness. For any given gauge stations, check if there is a relationship between stream flashiness trends and dam removals.

### Example 1
- For any given gauge stations, check if there is a relationship between trends and dam removals 
```{r, eval=TRUE, warning=FALSE, message=FALSE}
#dam_trends(c("01092000", "01100000", "01208500"), "1970-10-01", "1990-09-30")
```

### Example 2
```{r}
#dam_trends(study_sites)
```


## Calculate the RBI values for given sites
The flashiness of a stream reflects how quickly flow in a river or stream increases and decreases during a storm. One of the most important statistics hydrologists are interested in is the change in the short term daily flows relative to average yearly flows. This is what is known as the Richard Baker's Flashiness Index (RBI). For any given site or sites, the `rbi_df` function in this `easyrbi` package will output the respective rbi values for each site and the corresponding water year over a given time period. The function will take in the site numbers, the start and end date as characters and return a data frame. 

### Example 1
- Get the rbi values for one specified site
```{r}
#rbi_df("01564500", "1970-10-01", "1980-09-30")
```

### Example 2
- Returns the rbi values for multiple specified sites
```{r}
#rbi_df(c("01564500", "01567000", "01052500", "01038000"), "1970-10-01", "1980-09-30")
```


## Retrieve the site trends over time
After one has obtained the rbi values for their different sites, they can also use the `trends` function to get the summary statistics for the any of the USGS gauge sites. Among these are the sens.slope and the Mann-Kendall values for the sites. The function takes in the data frame produced by `rbi_df` and returns the corresponding summary statistics for each site. 

### Example 
- For each site, the function returns 14 different summary statistics.
```{r}
ex_data <- rbi_df(c("01038000", "01567000", "01052500"), "1970-10-01", "1980-09-30")

trends(x = ex_data) 
```

## Retrieve USGS gauge sites data
Hydrologists might want more information on a given site or sites for further analysis. The `sitedata` function provides more data for a specified site or sites that includes drainage per day, the drainage area and the corresponding water year. This function is more important when one wants more geological information about the sites over a given time period as it also provides actual site names, the state of the sites and their physical coordinates. 

### Example 
-For every site number, it returns 18 different variables for each day observed over the given period. Here, we have to decided to show only the head as the output data set is relatively large. 
```{r}
sitedata(c("01078000", "01129200", "01144000"), "1970-10-01", "1980-09-30") %>%
  head(10)
```
























